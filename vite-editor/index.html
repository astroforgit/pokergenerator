<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atari Strip Poker Image Editor</title>
  </head>
  <body>
    <header>
      <div style="display:flex; align-items:center">
          <h1>Atari Strip Poker Editor</h1>
          <span id="status" class="status">Loading...</span>
      </div>
      <div>
          <a href="http://localhost:5174/" target="_blank" style="padding: 10px 20px; background: #FF5722; color: white; text-decoration: none; border-radius: 5px; margin-right: 10px; display: inline-block;">üéÆ Play Strip Poker</a>
          <button id="helpBtn" class="primary" title="Show help and documentation">‚ùì Help</button>
          <button id="loadAtrBtn" title="Load a different ATR file">üìÅ Load Different ATR</button>
          <button id="saveAtrBtn" class="primary">üíæ Download Modified ATR</button>
          <input type="file" id="atrInput" accept=".atr" style="display:none">
      </div>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <ul id="fileList" class="file-list">
                <!-- Files will go here -->
            </ul>
        </div>
        <div class="editor-area">
            <!-- Tab Navigation -->
            <div id="tabNav" style="display:none; margin-bottom: 20px; border-bottom: 2px solid #444;">
                <button id="imageTabBtn" class="tab-button active" style="padding: 10px 20px; background: #333; border: none; color: #fff; cursor: pointer; border-bottom: 3px solid #4CAF50;">
                    üñºÔ∏è Image Editor
                </button>
                <button id="textTabBtn" class="tab-button" style="padding: 10px 20px; background: #333; border: none; color: #fff; cursor: pointer; border-bottom: 3px solid transparent;">
                    üìù Text Editor
                </button>
            </div>

            <!-- Image Editor Tab -->
            <div id="imageEditorTab" class="editor-tab" style="display:none;">
            <div id="editorControls" style="display:none; flex-direction: column; align-items: center;">
                <!-- Canvas Area -->
                <div class="canvas-wrapper">
                    <div class="canvas-container">
                        <canvas id="editorCanvas" width="160" height="140"></canvas>
                        <div id="cropOverlay" style="display:none;"></div>
                    </div>
                    <p style="font-size: 0.75rem; color: #888; margin: 5px 0;">
                        Display scaled to match Atari aspect ratio (pixels are rectangular, not square)
                    </p>
                </div>

                <!-- Image Import Section -->
                <div id="importSection" class="tool-section" style="display:none;">
                    <h3>Import Image</h3>

                    <!-- Result Preview (Top) - 160x140 with 4 colors -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; font-size: 0.9rem; color: #4CAF50;">üìä Result Preview (160√ó140, 4 colors)</h4>
                        <canvas id="resultCanvas" width="160" height="140" style="border: 2px solid #4CAF50; image-rendering: pixelated; width: 640px; height: 560px; background: #000;"></canvas>
                        <p style="font-size: 0.75rem; color: #888; margin: 5px 0;">This is how the image will look in the game</p>
                    </div>

                    <!-- Original Image Preview (Bottom) - Full resolution with crop tool -->
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0; font-size: 0.9rem; color: #FF9800;">üñºÔ∏è Original Image</h4>

                        <!-- Resize Mode Buttons -->
                        <div style="margin-bottom: 10px;">
                            <button id="autoFillBtn" class="primary" style="padding: 5px 15px; font-size: 0.85rem;">Auto Fill</button>
                            <button id="fitBtn" style="padding: 5px 15px; font-size: 0.85rem;">Fit (Show All)</button>
                            <button id="manualCropBtn" style="padding: 5px 15px; font-size: 0.85rem;">Manual Crop</button>
                        </div>

                        <div style="position: relative; display: inline-block; border: 2px solid #FF9800;">
                            <canvas id="originalCanvas" style="max-width: 800px; max-height: 600px; cursor: crosshair; background: #000;"></canvas>
                            <div id="cropBox" style="position: absolute; border: 2px dashed #4CAF50; background: rgba(76, 175, 80, 0.1); pointer-events: none; display: none;"></div>
                        </div>
                        <p style="font-size: 0.75rem; color: #888; margin: 5px 0;" id="cropModeHelp">Auto Fill: Fills frame, may crop edges</p>
                    </div>

                    <!-- Image Adjustments -->
                    <div style="margin: 15px 0; padding: 15px; background: #2a2a2a; border-radius: 5px; max-width: 800px;">
                        <h4 style="margin: 0 0 10px 0; font-size: 0.9rem;">‚öôÔ∏è Image Adjustments</h4>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 10px;">
                            <div>
                                <label style="font-size: 0.8rem; display: block; margin-bottom: 5px;">
                                    Brightness: <span id="brightnessValue">0</span>
                                </label>
                                <input type="range" id="brightnessSlider" min="-100" max="100" value="0" style="width: 100%;">
                            </div>

                            <div>
                                <label style="font-size: 0.8rem; display: block; margin-bottom: 5px;">
                                    Contrast: <span id="contrastValue">0</span>
                                </label>
                                <input type="range" id="contrastSlider" min="-100" max="100" value="0" style="width: 100%;">
                            </div>

                            <div>
                                <label style="font-size: 0.8rem; display: block; margin-bottom: 5px;">
                                    Saturation: <span id="saturationValue">1.0</span>
                                </label>
                                <input type="range" id="saturationSlider" min="0" max="200" value="100" style="width: 100%;">
                            </div>

                            <div>
                                <label style="font-size: 0.8rem; display: block; margin-bottom: 5px;">
                                    Dithering Algorithm
                                </label>
                                <select id="ditheringAlgorithm" style="width: 100%; padding: 5px; background: #1a1a1a; color: #fff; border: 1px solid #555; border-radius: 3px;">
                                    <option value="floyd-steinberg">Floyd-Steinberg (Best Quality)</option>
                                    <option value="atkinson">Atkinson (Mac Classic)</option>
                                    <option value="ordered">Ordered/Bayer (Pattern)</option>
                                    <option value="none">None (Nearest Color)</option>
                                </select>
                            </div>
                        </div>

                        <button id="resetAdjustmentsBtn" style="padding: 5px 10px; font-size: 0.8rem;">üîÑ Reset All</button>
                    </div>

                    <div class="toolbar">
                        <button id="applyImportBtn" class="primary">‚úì Apply to Canvas</button>
                        <button id="cancelImportBtn">‚úó Cancel</button>
                    </div>
                </div>

                <!-- Drawing Tools -->
                <div class="palette">
                    <div class="swatch selected" data-color="0" style="background-color: rgb(0,0,0)" title="Color 0 (Black)"></div>
                    <div class="swatch" data-color="1" style="background-color: rgb(148,108,0)" title="Color 1 (Dark Brown)"></div>
                    <div class="swatch" data-color="2" style="background-color: rgb(228,188,124)" title="Color 2 (Light Tan)"></div>
                    <div class="swatch" data-color="3" style="background-color: rgb(255,228,184)" title="Color 3 (Light Orange)"></div>
                </div>

                <div class="toolbar">
                    <button id="importPngBtn">üìÅ Import PNG</button>
                    <input type="file" id="pngInput" accept="image/*" style="display:none">
                    <button id="exportPngBtn">üì§ Export as PNG</button>
                    <button id="clearBtn">üóëÔ∏è Clear</button>
                    <button id="commitBtn" class="primary">üíæ Update File in Disk</button>
                </div>
                <p style="font-size: 0.8rem; color: #888; max-width: 600px; text-align: center; margin-top: 10px;">
                    "Update File in Disk" modifies the memory buffer. Click "Download Modified ATR" to save the final file to your computer.
                </p>
            </div>
            <div id="placeholder" style="margin-top: 100px; color: #666;">
                Select a file from the list to edit.
            </div>
            </div>
            <!-- End Image Editor Tab -->

            <!-- Text Editor Tab -->
            <div id="textEditorTab" class="editor-tab" style="display:none;">
                <div style="max-width: 900px; margin: 0 auto; padding: 20px;">
                    <h2>Game Text Editor</h2>
                    <p style="color: #888; margin-bottom: 20px;">
                        Edit in-game messages below. ‚ö†Ô∏è <strong>Text length must remain exactly the same</strong> to avoid corrupting the ATR file.
                    </p>

                    <div id="textEditorList" style="display: flex; flex-direction: column; gap: 15px;">
                        <!-- Text inputs will be generated here -->
                    </div>

                    <div style="margin-top: 30px; padding: 15px; background: #2a2a2a; border-radius: 5px;">
                        <button id="saveTextsBtn" class="primary" style="padding: 12px 24px; font-size: 1rem;">
                            üíæ Save All Text Changes
                        </button>
                        <p style="font-size: 0.8rem; color: #888; margin-top: 10px;">
                            After saving, click "Download Modified ATR" to save the file to your computer.
                        </p>
                    </div>
                </div>
            </div>
            <!-- End Text Editor Tab -->
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; overflow:auto;">
        <div style="background:#1a1a1a; max-width:800px; margin:50px auto; padding:30px; border-radius:10px; border:2px solid #4CAF50;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="color:#4CAF50; margin:0;">üìñ Atari Strip Poker Editor - Help</h2>
                <button id="closeHelpBtn" style="background:#f44336; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; font-size:1.2rem;">‚úï Close</button>
            </div>

            <div style="color:#ddd; line-height:1.6;">
                <h3 style="color:#4CAF50; border-bottom:2px solid #4CAF50; padding-bottom:5px;">üéÆ Getting Started</h3>
                <p>The editor automatically loads the embedded Strip Poker ATR file on startup. You can also load a different ATR file using the "Load Different ATR" button.</p>

                <h3 style="color:#4CAF50; border-bottom:2px solid #4CAF50; padding-bottom:5px; margin-top:25px;">üñºÔ∏è Image Editor</h3>
                <p><strong>Select an Image:</strong> Click on any file in the left sidebar (OP1.1, OP1.2, etc.) to load it for editing.</p>

                <p><strong>Drawing Tools:</strong></p>
                <ul style="margin-left:20px;">
                    <li><strong>Draw:</strong> Click and drag on the canvas to draw with the selected color</li>
                    <li><strong>Erase:</strong> Click "Erase" button, then click and drag to erase (sets to black)</li>
                    <li><strong>Clear:</strong> Click "Clear" to fill the entire canvas with black</li>
                    <li><strong>Color Palette:</strong> Click any of the 4 colors (Black, Brown, Orange, White) to select it</li>
                </ul>

                <p><strong>Import PNG Image:</strong></p>
                <ul style="margin-left:20px;">
                    <li>Click "üì∑ Import PNG" button</li>
                    <li>Select a PNG file from your computer</li>
                    <li><strong>Image Processing:</strong> The image is automatically cropped to preserve the 160:140 aspect ratio (8:7). Adjustments are applied to the original full-resolution image before scaling down for best quality.</li>
                    <li><strong>Adjust Settings:</strong>
                        <ul style="margin-left:20px;">
                            <li><strong>Brightness:</strong> -100 to +100 (makes image darker/lighter)</li>
                            <li><strong>Contrast:</strong> -100 to +100 (adjusts contrast)</li>
                            <li><strong>Saturation:</strong> 0 to 2.0 (0=grayscale, 1=normal, 2=vibrant)</li>
                        </ul>
                    </li>
                    <li><strong>Dithering Algorithm:</strong>
                        <ul style="margin-left:20px;">
                            <li><strong>Floyd-Steinberg:</strong> Best quality, smooth gradients (recommended)</li>
                            <li><strong>Atkinson:</strong> Mac Classic style, preserves highlights</li>
                            <li><strong>Ordered/Bayer:</strong> Retro crosshatch pattern</li>
                            <li><strong>None:</strong> Sharp, no dithering (nearest color)</li>
                        </ul>
                    </li>
                    <li>Preview updates in real-time as you adjust settings</li>
                    <li>Click "‚úì Apply to Canvas" when satisfied with preview</li>
                </ul>

                <p><strong>Save Changes:</strong> Click "‚úì Update File in Disk" to save your edits to memory.</p>

                <h3 style="color:#4CAF50; border-bottom:2px solid #4CAF50; padding-bottom:5px; margin-top:25px;">üìù Text Editor</h3>
                <p>Switch to the "Text Editor" tab to edit game text strings.</p>

                <p><strong>74 Editable Text Strings:</strong></p>
                <ul style="margin-left:20px;">
                    <li><strong>Game Messages (14):</strong> Trigger prompts, game results, clothing messages</li>
                    <li><strong>COM1 Comments (30):</strong> Opponent taunts and reactions (set 1)</li>
                    <li><strong>COM2 Comments (30):</strong> Opponent taunts and reactions (set 2)</li>
                </ul>

                <p><strong>Editing Text:</strong></p>
                <ul style="margin-left:20px;">
                    <li>Click in any text field to edit</li>
                    <li><strong>‚ö†Ô∏è IMPORTANT:</strong> Text must be EXACTLY the same length as the original!</li>
                    <li><strong>Character Counter:</strong>
                        <ul style="margin-left:20px;">
                            <li><span style="color:#4CAF50;">üü¢ Green:</span> Correct length - ready to save</li>
                            <li><span style="color:#ff9800;">üü† Orange:</span> Too short - add more characters</li>
                            <li><span style="color:#f44336;">üî¥ Red:</span> Too long - remove characters</li>
                        </ul>
                    </li>
                    <li>Use spaces to pad shorter text to the required length</li>
                    <li>Click "üíæ Save All Text Changes" when all texts are correct length</li>
                </ul>

                <h3 style="color:#4CAF50; border-bottom:2px solid #4CAF50; padding-bottom:5px; margin-top:25px;">üíæ Saving Your Work</h3>
                <p><strong>Download Modified ATR:</strong> Click "üíæ Download Modified ATR" to download your customized game file.</p>
                <p>All changes are kept in memory until you download. The downloaded file will be named "StripPoker_Modified.atr".</p>

                <h3 style="color:#4CAF50; border-bottom:2px solid #4CAF50; padding-bottom:5px; margin-top:25px;">üõ°Ô∏è Safety Features</h3>
                <ul style="margin-left:20px;">
                    <li>Text length validation prevents ATR corruption</li>
                    <li>Cannot save if any text has wrong length</li>
                    <li>File size remains exactly 92,176 bytes</li>
                    <li>All changes are in-memory until download</li>
                </ul>

                <h3 style="color:#4CAF50; border-bottom:2px solid #4CAF50; padding-bottom:5px; margin-top:25px;">üí° Tips</h3>
                <ul style="margin-left:20px;">
                    <li>For best PNG import results, use images with good contrast</li>
                    <li>Try different dithering algorithms to see which looks best</li>
                    <li>Adjust brightness/contrast before applying to canvas</li>
                    <li>Use spaces to pad text strings to the required length</li>
                    <li>Test your modified ATR in an Atari emulator!</li>
                </ul>

                <h3 style="color:#4CAF50; border-bottom:2px solid #4CAF50; padding-bottom:5px; margin-top:25px;">üìã Technical Info</h3>
                <ul style="margin-left:20px;">
                    <li><strong>Image Format:</strong> 160√ó140 pixels, 4 colors</li>
                    <li><strong>Colors:</strong> Black (#000000), Brown (#684420), Orange (#C8A050), White (#F8F8F8)</li>
                    <li><strong>File Format:</strong> Atari ATR disk image (92,176 bytes)</li>
                    <li><strong>File System:</strong> Atari DOS 2.0S</li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
